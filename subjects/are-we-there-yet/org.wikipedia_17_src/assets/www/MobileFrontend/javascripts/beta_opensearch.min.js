MobileFrontend.opensearch=(function(){var b="/api.php",l=-1,c=500,y=15,q,j=document.getElementById("search"),n,r=document.getElementById("content"),o=document.getElementById("footer"),x=MobileFrontend.setting("scriptPath")+"/extensions/MobileFrontend/stylesheets/images/blank.gif",v=document.getElementById("clearsearch"),i=false,d,m=MobileFrontend.utils;b=MobileFrontend.setting("scriptPath")+b;function z(){var u,E,C,D;E=document.getElementById("header");C=document.getElementById("content");D=document.getElementById("footer");if(!i){m(document.body).addClass("full-screen-search");window.scrollTo(0,1);u=document.getElementById("remove-results");if(!u){u=document.createElement("img");u.setAttribute("id","remove-results");m(u).bind("click",w);u.setAttribute("src",x);u.setAttribute("alt",MobileFrontend.message("remove-results"));E.insertBefore(u,E.firstChild)}i=true}}function w(){m(document.body).removeClass("full-screen-search");if(i){i=false}}var k=function(u){if(u){u.preventDefault()}clearTimeout(l);q=j.value;if(q.length>1){q=encodeURIComponent(q);l=setTimeout(function(){h(q)},c)}};function B(u){if(j.value.length===0){w()}else{k(u)}}function a(D,C){var u=navigator.userAgent;if(u.match(/Android 2\./)||u.match(/Opera Mini/)){C(D)}else{window.clearTimeout(d);d=window.setTimeout(function(){C(D)},500)}}function A(){var u=document.getElementById("searchForm");window.setInterval(function(){var C=j.value;if(C.length>1&&C!==n){n=C;m(u).addClass("notEmpty");k()}else{if(!C){m(u).removeClass("notEmpty")}}},c);m(j).bind("focus",function(C){a(C,z)});m(j).bind("blur",function(C){a(C,B)})}function h(u){m(j).addClass("searching");url=b+"?action=opensearch&limit="+y+"&namespace=0&format=xml&search="+u;m.ajax({url:url,success:function(C){if(m(document.body).hasClass("full-screen-search")){p(g(C));m(j).removeClass("searching")}}})}function g(F){var G=[],C,D,E,u=F.getElementsByTagName("Item");for(C=0;C<u.length;C++){D=u[C];E={label:m(D.getElementsByTagName("Text")[0]).text(),value:m(D.getElementsByTagName("Url")[0]).text()};G.push(E)}return G}function e(D){var C=document.createTextNode(D),u=document.createElement("div");u.appendChild(C);return u.innerHTML}function t(u){return u.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}function p(K){var E=document.getElementById("results"),G,F,D=e(document.getElementById("search").value),J,C,u,H,I;if(!K||K.length<1){E.innerHTML='<ul class="suggestions-results" title="No Results"><li class="suggestions-result">'+MobileFrontend.message("mobile-frontend-search-noresults")+"</li></div>"}else{if(E.firstChild){E.removeChild(E.firstChild)}G=document.createElement("ul");G.className="suggestions-results";E.appendChild(G);for(F=0;F<K.length;F++){J=K[F];u=document.createElement("li");u.setAttribute("title",J.label);u.className="suggestions-result";H=document.createElement("a");H.setAttribute("href",J.value.replace(/^(?:\/\/|[^\/]+)*\//,"/"));H.className="search-result-item";I=document.createTextNode(J.label);H.appendChild(I);u.appendChild(H);G.appendChild(u);C=t(D);H.innerHTML=H.innerHTML.replace(new RegExp("("+C+")","ig"),"<strong>$1</strong>")}}}function f(){var F=document.getElementById("clearsearch"),C=document.getElementById("results"),u=document.getElementById("search");function D(G){window.setTimeout(function(){u.value=""},100);C.innerHTML="";G.preventDefault()}function E(){u.select()}m(F).bind("mousedown",D);m(u).bind("click",E)}function s(){A();if(document.activeElement&&document.activeElement.id==="search"){z()}function u(){document.getElementById("search").blur()}document.getElementById("results").ontouchstart=u;f()}MobileFrontend.registerModule("opensearch",1000);return{init:s,initClearSearch:f,writeResults:p,createObjectArray:g,removeResults:w}}());